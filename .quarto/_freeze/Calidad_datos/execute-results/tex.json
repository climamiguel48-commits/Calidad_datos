{
  "hash": "fdb8ae29da563c2531b537e5b86d58a4",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"**Informe de control de calidad de datos climáticos - Parcela 3**\"\nauthor: \"Ing. Miguel Silva\"\ndate: \"today\"\n---\n\n# Introducción\n\nEn este informe se presenta el control de calidad de la base de datos climáticos registrada en la Parcela 3, a partir del archivo `Datos_Parcela_3.xlsx`.\n\nEl objetivo principal es identificar y cuantificar:\n\n-   Datos faltantes por variable.\\\n\n-   Valores fuera de rangos físicos razonables.\\\n\n-   Registros atípicos que puedan comprometer análisis posteriores (balance de energía, estimación de ET, etc.).\n\n-   Visualizar el comportamiento temporal de las variables.\n\n# Descripción general de la base de datos\n\nLa base de datos esta conformada por los registros horarios de las siguientes variables:\n\n**Variables meteorológicas**:\n\n-   Temperatura (°C)\n\n-   Humedad relativa (%)\n\n-   Velocidad del viento (m/s)\n\n-   Dirección del viento (°)\n\n-   Presión atmosférica (mbar)\n\n-   Radiación global (Wm-2)\n\n-   Precipitación (mm)\n\n**Variables de flujos de energía**:\n\n-   Temperatura superficial (°C)\n\n-   Flujo de energía en el suelo (Wm-2)\n\n-   Radiación Neta (Wm-2)\n\n-   Temperatura termocupla 1 (°C)\n\n-   Temperatura termocupla 2 (°C)\n\n-   Humedad del suelo a los 5 cm (m3/m3)\n\n-   Humedad del suelo a los 40 cm (m3/m3)\n\nPara su procesamiento preliminar se aplica lo siguiente:\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 3\n  fecha_inicio        fecha_fin           n_registros\n  <dttm>              <dttm>                    <int>\n1 2025-07-21 14:00:00 2025-11-28 15:00:00        2438\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 9\n  n_Temperatura_aire_C n_Humedad_relativa_porc n_Precipitacion_mm\n                 <int>                   <int>              <int>\n1                 2434                    2434               2434\n# i 6 more variables: n_Velocidad_viento_ms <int>, n_Radiacion_neta_Wm2 <int>,\n#   n_Radiacion_global_Wm2 <int>, n_Temperatura_superficie_C <int>,\n#   n_Humedad_suelo_5cm_m3m3 <int>, n_Humedad_suelo_40cm_m3m3 <int>\n```\n\n\n:::\n:::\n\n\n# Análisis exploratorio\n\nEste análisis primero identifica el período temporal cubierto, el número de registros y variables, y determina qué columnas contienen información numérica. Luego calcula estadísticas descriptivas básicas; media, mediana, desviación estándar, mínimos, máximos y cantidad de datos faltantes para todas las variables, permitiendo detectar rangos típicos, dispersión y posibles anomalías. Finalmente, cuantifica los valores ausentes por variable, lo cual ayuda a evaluar la completitud del conjunto de datos antes de aplicar controles de calidad más estrictos.\n\n\n::: {.cell}\n\n:::\n\n\n# Control de calidad\n\nLas reglas de control de calidad aplicadas en este informe son:\n\n**Continuidad temporal**\n\nVerificación de que la serie está ordenada y sin duplicados en fecha_hora.\n\nRangos físicos razonables (pueden ajustarse a tus criterios locales):\n\nTemperatura_aire_C: -10 a 45 °C\n\nHumedad_relativa_porc: 0 a 100 %\n\nPrecipitacion_mm: ≥ 0 mm\n\nVelocidad_viento_ms: ≥ 0 m/s\n\nRadiacion_neta_Wm2: -200 a 1000 W/m²\n\n**Tratamiento de datos**\n\nLos valores fuera de rango se marcan mediante flags y, en la base validada, se reemplazan por NA para evitar su uso directo en análisis.\n\n\n::: {.cell}\n\n:::\n\n\n# Resultados\n\n**Resultados del análisis exploratorio**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresultados_ae <- analisis_exploratorio(datos_brutos)\n\n#Info básica en tabla\n\ninfo_basica <- as.data.frame(resultados_ae$info_basica)\ninfo_basica\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  n_filas n_columnas fecha_inicio  fecha_fin duracion_dias\n1    2438         32   1753106400 1764342000      130.0417\n```\n\n\n:::\n\n```{.r .cell-code}\n#| label: estadisticas-principales\n#| echo: true\n\nestadisticas_df <- purrr::map_dfr(\nresultados_ae$estadisticas,\n~ as.data.frame(.x),\n.id = \"variable\"\n)\n\nestadisticas_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    variable         media   mediana   desviacion       min\n1       Radiacion_global_Wm2  1.891088e+02   10.8350 2.617007e+02     0.000\n2           Precipitacion_mm  2.940427e-02    0.0000 2.730409e-01     0.000\n3               Rayos_conteo  2.875924e-03    0.0000 8.354031e-02     0.000\n4        Velocidad_viento_ms  5.160140e-01    0.4580 3.449411e-01     0.048\n5    Direccion_viento_grados  1.761297e+02  163.9000 7.951649e+01     0.900\n6                  Rachas_ms  1.511889e+00    1.3470 1.043812e+00     0.123\n7         Temperatura_aire_C  1.559380e+01   14.2250 6.835956e+00     2.317\n8   Presion_atmosferica_mbar  1.016620e+03 1016.3310 3.036572e+00  1009.648\n9      Humedad_relativa_porc  6.761639e+01   70.6500 2.316700e+01    15.700\n10     Radiacion_global_MJm2  6.816402e-01    0.0366 9.424293e-01     0.000\n11  Temperatura_superficie_C  1.596208e+01   13.7500 8.175708e+00     1.126\n12   Flujo_energia_suelo_Wm2 -9.835949e-02   -1.0150 4.760450e+00   -10.820\n13        Radiacion_neta_Wm2  5.264392e+02  317.9000 7.687920e+02 -1642.000\n14 Temperatura_termocupla1_C  1.658387e+01   14.1500 8.853681e+00     0.719\n15 Temperatura_termocupla2_C  1.658374e+01   14.1500 8.853524e+00     0.721\n16    Humedad_suelo_5cm_m3m3  3.570538e-01    0.3650 3.624735e-02     0.214\n17   Humedad_suelo_40cm_m3m3  4.897650e-01    0.4910 5.753877e-03     0.476\n         max nas\n1   873.0000   0\n2     6.0350   4\n3     3.0000   4\n4     2.1030   4\n5   359.7000   4\n6     6.3280   4\n7    32.9200   4\n8  1027.0980   4\n9   100.0000   4\n10    3.1428   4\n11   36.3800   4\n12   12.4600   4\n13 3004.0000   4\n14   38.4300   4\n15   38.4300   4\n16    0.4500   4\n17    0.5010   4\n```\n\n\n:::\n\n```{.r .cell-code}\n#| label: valores-faltantes\n#| echo: true\n\nvalores_faltantes_df <- data.frame(\nvariable = names(resultados_ae$valores_faltantes),\nn_na = as.numeric(resultados_ae$valores_faltantes)\n)\n\nvalores_faltantes_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    variable n_na\n1                 fecha_hora  105\n2           Precipitacion_mm    4\n3               Rayos_conteo    4\n4                Dist_km_Avg    4\n5        Velocidad_viento_ms    4\n6    Direccion_viento_grados    4\n7                  Rachas_ms    4\n8         Temperatura_aire_C    4\n9                VP_mbar_Avg    4\n10  Presion_atmosferica_mbar    4\n11                      ETos    4\n12                       Rso    4\n13     Humedad_relativa_porc    4\n14                     RHT_C    4\n15            TiltNS_deg_Avg    4\n16            TiltWE_deg_Avg    4\n17     Radiacion_global_MJm2    4\n18                    CVMeta   14\n19              Invalid_Wind    4\n20                  TT_C_Avg    4\n21  Temperatura_superficie_C    4\n22   Flujo_energia_suelo_Wm2    4\n23        Radiacion_neta_Wm2    4\n24               CNR_Wm2_Avg    4\n25 Temperatura_termocupla1_C    4\n26 Temperatura_termocupla2_C    4\n27    Humedad_suelo_5cm_m3m3    4\n28   Humedad_suelo_40cm_m3m3    4\n```\n\n\n:::\n:::\n\n\n**Resumen de flags por variable**\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 15\n  temp_ok temp_fuera temp_na hr_ok hr_fuera hr_na pp_ok pp_negativa pp_na ws_ok\n    <int>      <int>   <int> <int>    <int> <int> <int>       <int> <int> <int>\n1    2434          0       4  2434        0     4  2434           0     4  2434\n# i 5 more variables: ws_negativa <int>, ws_na <int>, rn_ok <int>,\n#   rn_fuera <int>, rn_na <int>\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 15\n  temp_ok temp_fuera temp_na hr_ok hr_fuera hr_na pp_ok pp_negativa pp_na ws_ok\n    <dbl>      <dbl>   <dbl> <dbl>    <dbl> <dbl> <dbl>       <dbl> <dbl> <dbl>\n1    99.8          0   0.164  99.8        0 0.164  99.8           0 0.164  99.8\n# i 5 more variables: ws_negativa <dbl>, ws_na <dbl>, rn_ok <dbl>,\n#   rn_fuera <dbl>, rn_na <dbl>\n```\n\n\n:::\n:::\n\n\n**Resultados del control de calidad**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresultados_cc <- control_calidad(datos_brutos)\n\nfuera_rango_df <- purrr::map_dfr(\nresultados_cc$fuera_rango,\n~ as.data.frame(.x),\n.id = \"variable\"\n)\n\natipicos_iqr_df <- purrr::map_dfr(\nresultados_cc$atipicos_iqr,\n~ as.data.frame(.x),\n.id = \"variable\"\n)\n\ncompletitud_df <- data.frame(\nvariable = names(resultados_cc$completitud),\ncompletitud = as.numeric(resultados_cc$completitud)\n)\n\nlist(\nfuera_rango = fuera_rango_df,\natipicos_iqr = atipicos_iqr_df,\ncompletitud = completitud_df,\nsaltos_tiempo = resultados_cc$saltos_temporales\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$fuera_rango\n                 variable n_fuera_rango porcentaje\n1      Temperatura_aire_C             0          0\n2   Humedad_relativa_porc             0          0\n3     Velocidad_viento_ms             0          0\n4    Radiacion_global_Wm2             0          0\n5        Precipitacion_mm             0          0\n6  Humedad_suelo_5cm_m3m3             0          0\n7 Humedad_suelo_40cm_m3m3             0          0\n\n$atipicos_iqr\n                    variable n_atipicos porcentaje\n1       Radiacion_global_Wm2          0       0.00\n2           Precipitacion_mm        179       7.34\n3               Rayos_conteo          3       0.12\n4        Velocidad_viento_ms         10       0.41\n5    Direccion_viento_grados          0       0.00\n6                  Rachas_ms          4       0.16\n7         Temperatura_aire_C          0       0.00\n8   Presion_atmosferica_mbar         28       1.15\n9      Humedad_relativa_porc          0       0.00\n10     Radiacion_global_MJm2          0       0.00\n11  Temperatura_superficie_C          0       0.00\n12   Flujo_energia_suelo_Wm2          0       0.00\n13        Radiacion_neta_Wm2         66       2.71\n14 Temperatura_termocupla1_C          0       0.00\n15 Temperatura_termocupla2_C          0       0.00\n16    Humedad_suelo_5cm_m3m3        190       7.79\n17   Humedad_suelo_40cm_m3m3          0       0.00\n\n$completitud\n                    variable completitud\n1       Radiacion_global_Wm2      100.00\n2           Precipitacion_mm       99.84\n3               Rayos_conteo       99.84\n4        Velocidad_viento_ms       99.84\n5    Direccion_viento_grados       99.84\n6                  Rachas_ms       99.84\n7         Temperatura_aire_C       99.84\n8   Presion_atmosferica_mbar       99.84\n9      Humedad_relativa_porc       99.84\n10     Radiacion_global_MJm2       99.84\n11  Temperatura_superficie_C       99.84\n12   Flujo_energia_suelo_Wm2       99.84\n13        Radiacion_neta_Wm2       99.84\n14 Temperatura_termocupla1_C       99.84\n15 Temperatura_termocupla2_C       99.84\n16    Humedad_suelo_5cm_m3m3       99.84\n17   Humedad_suelo_40cm_m3m3       99.84\n\n$saltos_tiempo\n[1] 103\n```\n\n\n:::\n:::\n\n\n# Visualización gráfica de las variables\n\n**Series temporales facetadas de variables principales**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Calidad_datos_files/figure-pdf/unnamed-chunk-3-1.pdf)\n:::\n:::\n\n\n**Humedad del suelo en el tiempo (2 profundidades)**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Calidad_datos_files/figure-pdf/unnamed-chunk-4-1.pdf)\n:::\n:::\n\n\n**Precipitación diaria acumulada**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Precipitación diaria acumulada.](Calidad_datos_files/figure-pdf/graf-precipitacion-diaria-1.pdf)\n:::\n:::\n\n\n**Rosa de vientos**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Rosa de vientos (dirección y velocidad del viento).](Calidad_datos_files/figure-pdf/graf-rosa-vientos-1.pdf)\n:::\n:::\n\n\n**Distribución de temperaturas**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribución de temperaturas del aire, superficie y termocuplas.](Calidad_datos_files/figure-pdf/graf-distribucion-temperaturas-1.pdf)\n:::\n:::\n\n\n**Generación de base de datos validada**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos_validados <- datos_qc %>%\nmutate(\nTemperatura_aire_C = if_else(flag_temp_rango == \"ok\", Temperatura_aire_C, NA_real_),\nHumedad_relativa_porc = if_else(flag_hr_rango == \"ok\", Humedad_relativa_porc, NA_real_),\nPrecipitacion_mm = if_else(flag_pp_rango == \"ok\", Precipitacion_mm, NA_real_),\nVelocidad_viento_ms = if_else(flag_ws_rango == \"ok\", Velocidad_viento_ms, NA_real_),\nRadiacion_neta_Wm2 = if_else(flag_rn_rango == \"ok\", Radiacion_neta_Wm2, NA_real_)\n)\n\nreadr::write_csv(datos_validados, \"Datos_Parcela_3_validado.csv\")\n\ndatos_validados %>%\nsummarise(\nn_temp_validas = sum(!is.na(Temperatura_aire_C)),\nn_hr_validas = sum(!is.na(Humedad_relativa_porc)),\nn_pp_validas = sum(!is.na(Precipitacion_mm)),\nn_ws_validas = sum(!is.na(Velocidad_viento_ms)),\nn_rn_validas = sum(!is.na(Radiacion_neta_Wm2))\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 5\n  n_temp_validas n_hr_validas n_pp_validas n_ws_validas n_rn_validas\n           <int>        <int>        <int>        <int>        <int>\n1           2434         2434         2434         2434         1821\n```\n\n\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n`{#}`\n",
    "supporting": [
      "Calidad_datos_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}