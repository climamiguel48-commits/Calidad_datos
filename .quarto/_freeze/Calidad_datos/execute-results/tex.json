{
  "hash": "bdbfc0b5491f35abb8e7e18459b0504b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"**Informe de control de calidad de datos climáticos - Parcela 3**\"\nauthor: \"Ing. Miguel Silva\"\ndate: \"today\"\n---\n\nIntroducción\n===============\n\nEn este informe se presenta el control de calidad de la base de datos climáticos registrada en la Parcela 3, a partir del archivo `Datos_Parcela_3.xlsx`.\n\nEl objetivo principal es identificar y cuantificar:\n\n- Datos faltantes por variable.  \n- Valores fuera de rangos físicos razonables.  \n- Registros atípicos que puedan comprometer análisis posteriores (balance de energía, estimación de ET, etc.).\n\n- Visualizar el comportamiento temporal de las variables. \n\n\nDescripción general de la base de datos\n==========================================\n\nLa base de datos esta conformada por los registros horarios de las siguientes variables: \n\n**Variables meteorológicas**:\n\n- Temperatura (°C)\n\n- Humedad relativa (%)\n\n- Velocidad del viento (m/s)\n\n- Dirección del viento (°)\n\n- Presión atmosférica (mbar)\n\n- Radiación global (Wm-2)\n\n- Precipitación (mm)\n\n**Variables de flujos de energía**:\n\n- Temperatura superficial (°C)\n\n- Flujo de energía en el suelo (Wm-2)\n\n- Radiación Neta (Wm-2)\n\n- Temperatura termocupla 1 (°C)\n\n- Temperatura termocupla 2 (°C)\n\n- Humedad del suelo a los 5 cm (m3/m3)\n\n- Humedad del suelo a los 40 cm (m3/m3)\n\nPara su procesamiento preliminar se aplica lo siguiente: \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar paquetes\nlibrary(readxl)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAdjuntando el paquete: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(lubridate)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAdjuntando el paquete: 'lubridate'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(purrr)\nlibrary(readr)\nlibrary(ggpmisc)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCargando paquete requerido: ggpp\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 methods overwritten by 'ggpp':\n  method                  from   \n  heightDetails.titleGrob ggplot2\n  widthDetails.titleGrob  ggplot2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAdjuntando el paquete: 'ggpp'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:ggplot2':\n\n    annotate\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(openair)\n\n# Lectura del archivo original\ndatos_brutos <- readxl::read_excel(\"Datos_Parcela_3.xlsx\")\n\n# Renombrar variables según indicaciones\ndatos_brutos <- datos_brutos %>%\n  rename(\n    Radiacion_global_Wm2          = SlrFD_W_Avg,\n    Precipitacion_mm             = Rain_mm_Tot,\n    Rayos_conteo                 = Strikes_Tot,\n    Velocidad_viento_ms          = WS_ms_Avg,\n    Direccion_viento_grados      = WindDir,\n    Rachas_ms                    = MaxWS_ms_Avg,\n    Temperatura_aire_C           = AirT_C_Avg,\n    Presion_atmosferica_mbar     = BP_mbar_Avg,\n    Humedad_relativa_porc        = RH,\n    Radiacion_global_MJm2        = SlrTF_MJ_Tot,\n    Temperatura_superficie_C     = SBT_C_Avg,\n    Flujo_energia_suelo_Wm2      = SHF_Avg,\n    Radiacion_neta_Wm2           = NR_Wm2_Avg,\n    Temperatura_termocupla1_C    = Temp_TC1_C_Avg,\n    Temperatura_termocupla2_C    = Temp_TC2_C_Avg,\n    Humedad_suelo_5cm_m3m3       = SWC_5CM_Avg,\n    Humedad_suelo_40cm_m3m3      = SWC_40CM_Avg\n  ) %>%\n  mutate(\n    fecha_hora = ymd_hms(fecha_hora),\n    fecha      = as_date(fecha)\n  ) %>%\n  # Forzar variables climáticas a numérico\n  mutate(\n    Radiacion_global_Wm2        = as.numeric(Radiacion_global_Wm2),\n    Precipitacion_mm            = as.numeric(Precipitacion_mm),\n    Rayos_conteo                = as.numeric(Rayos_conteo),\n    Velocidad_viento_ms         = as.numeric(Velocidad_viento_ms),\n    Direccion_viento_grados     = as.numeric(Direccion_viento_grados),\n    Rachas_ms                   = as.numeric(Rachas_ms),\n    Temperatura_aire_C          = as.numeric(Temperatura_aire_C),\n    Presion_atmosferica_mbar    = as.numeric(Presion_atmosferica_mbar),\n    Humedad_relativa_porc       = as.numeric(Humedad_relativa_porc),\n    Radiacion_global_MJm2       = as.numeric(Radiacion_global_MJm2),\n    Temperatura_superficie_C    = as.numeric(Temperatura_superficie_C),\n    Flujo_energia_suelo_Wm2     = as.numeric(Flujo_energia_suelo_Wm2),\n    Radiacion_neta_Wm2          = as.numeric(Radiacion_neta_Wm2),\n    Temperatura_termocupla1_C   = as.numeric(Temperatura_termocupla1_C),\n    Temperatura_termocupla2_C   = as.numeric(Temperatura_termocupla2_C),\n    Humedad_suelo_5cm_m3m3      = as.numeric(Humedad_suelo_5cm_m3m3),\n    Humedad_suelo_40cm_m3m3     = as.numeric(Humedad_suelo_40cm_m3m3)\n  ) %>%\n  arrange(fecha_hora)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: There was 1 warning in `mutate()`.\ni In argument: `fecha_hora = ymd_hms(fecha_hora)`.\nCaused by warning:\n!  105 failed to parse.\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: resumen-temporal\n#| echo: true\n\ndatos_brutos %>%\nsummarise(\nfecha_inicio = min(fecha_hora, na.rm = TRUE),\nfecha_fin = max(fecha_hora, na.rm = TRUE),\nn_registros = n()\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 3\n  fecha_inicio        fecha_fin           n_registros\n  <dttm>              <dttm>                    <int>\n1 2025-07-21 14:00:00 2025-11-28 15:00:00        2438\n```\n\n\n:::\n\n```{.r .cell-code}\n#| label: resumen-completitud\n#| echo: true\n\ndatos_brutos %>%\nsummarise(\nn_Temperatura_aire_C = sum(!is.na(Temperatura_aire_C)),\nn_Humedad_relativa_porc = sum(!is.na(Humedad_relativa_porc)),\nn_Precipitacion_mm = sum(!is.na(Precipitacion_mm)),\nn_Velocidad_viento_ms = sum(!is.na(Velocidad_viento_ms)),\nn_Radiacion_neta_Wm2 = sum(!is.na(Radiacion_neta_Wm2)),\nn_Radiacion_global_Wm2 = sum(!is.na(Radiacion_global_Wm2)),\nn_Temperatura_superficie_C = sum(!is.na(Temperatura_superficie_C)),\nn_Humedad_suelo_5cm_m3m3 = sum(!is.na(Humedad_suelo_5cm_m3m3)),\nn_Humedad_suelo_40cm_m3m3 = sum(!is.na(Humedad_suelo_40cm_m3m3))\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 9\n  n_Temperatura_aire_C n_Humedad_relativa_porc n_Precipitacion_mm\n                 <int>                   <int>              <int>\n1                 2434                    2434               2434\n# i 6 more variables: n_Velocidad_viento_ms <int>, n_Radiacion_neta_Wm2 <int>,\n#   n_Radiacion_global_Wm2 <int>, n_Temperatura_superficie_C <int>,\n#   n_Humedad_suelo_5cm_m3m3 <int>, n_Humedad_suelo_40cm_m3m3 <int>\n```\n\n\n:::\n:::\n\n\nAnálisis exploratorio\n========================\n\nEste análisis primero identifica el período temporal cubierto, el número de registros y variables, y determina qué columnas contienen información numérica. Luego calcula estadísticas descriptivas básicas; media, mediana, desviación estándar, mínimos, máximos y cantidad de datos faltantes para todas las variables, permitiendo detectar rangos típicos, dispersión y posibles anomalías. Finalmente, cuantifica los valores ausentes por variable, lo cual ayuda a evaluar la completitud del conjunto de datos antes de aplicar controles de calidad más estrictos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanalisis_exploratorio <- function(datos) {\nresultados_ae <- list()\n\n#Información básica (proteger si fecha_hora es todo NA)\n\nfecha_min <- ifelse(all(is.na(datos$fecha_hora)), NA, min(datos$fecha_hora, na.rm = TRUE))\nfecha_max <- ifelse(all(is.na(datos$fecha_hora)), NA, max(datos$fecha_hora, na.rm = TRUE))\nduracion <- ifelse(\nis.na(fecha_min) | is.na(fecha_max),\nNA,\nas.numeric(difftime(fecha_max, fecha_min, units = \"days\"))\n)\n\nresultados_ae$info_basica <- list(\nn_filas = nrow(datos),\nn_columnas = ncol(datos),\nfecha_inicio = fecha_min,\nfecha_fin = fecha_max,\nduracion_dias = duracion\n)\n\n#Variables numéricas disponibles\n\nvars_numericas <- datos %>% dplyr::select(where(is.numeric)) %>% colnames()\nresultados_ae$variables_numericas <- vars_numericas\n\n#Variables principales\n\nvars_principales <- c(\n\"Radiacion_global_Wm2\",\n\"Precipitacion_mm\",\n\"Rayos_conteo\",\n\"Velocidad_viento_ms\",\n\"Direccion_viento_grados\",\n\"Rachas_ms\",\n\"Temperatura_aire_C\",\n\"Presion_atmosferica_mbar\",\n\"Humedad_relativa_porc\",\n\"Radiacion_global_MJm2\",\n\"Temperatura_superficie_C\",\n\"Flujo_energia_suelo_Wm2\",\n\"Radiacion_neta_Wm2\",\n\"Temperatura_termocupla1_C\",\n\"Temperatura_termocupla2_C\",\n\"Humedad_suelo_5cm_m3m3\",\n\"Humedad_suelo_40cm_m3m3\"\n)\n\n#Estadísticas descriptivas\n\nestadisticas <- list()\nfor (var in vars_principales) {\nif (var %in% colnames(datos)) {\nestadisticas[[var]] <- list(\nmedia = mean(datos[[var]], na.rm = TRUE),\nmediana = median(datos[[var]], na.rm = TRUE),\ndesviacion = sd(datos[[var]], na.rm = TRUE),\nmin = min(datos[[var]], na.rm = TRUE),\nmax = max(datos[[var]], na.rm = TRUE),\nnas = sum(is.na(datos[[var]]))\n)\n}\n}\nresultados_ae$estadisticas <- estadisticas\n\n#Conteo de valores faltantes\n\nna_count <- colSums(is.na(datos))\nresultados_ae$valores_faltantes <- na_count[na_count > 0]\n\nreturn(resultados_ae)\n}\n```\n:::\n\n\nControl de calidad\n==================\n\nLas reglas de control de calidad aplicadas en este informe son:\n\n**Continuidad temporal**\n\nVerificación de que la serie está ordenada y sin duplicados en fecha_hora.\n\nRangos físicos razonables (pueden ajustarse a tus criterios locales):\n\nTemperatura_aire_C: -10 a 45 °C\n\nHumedad_relativa_porc: 0 a 100 %\n\nPrecipitacion_mm: ≥ 0 mm\n\nVelocidad_viento_ms: ≥ 0 m/s\n\nRadiacion_neta_Wm2: -200 a 1000 W/m²\n\n**Tratamiento de datos**\n\nLos valores fuera de rango se marcan mediante flags y, en la base validada, se reemplazan por NA para evitar su uso directo en análisis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncontrol_calidad <- function(datos) {\nresultados_cc <- list()\n\n#Límites físicos\n\nlimites <- list(\nTemperatura_aire_C = c(-10, 45),\nHumedad_relativa_porc = c(0, 100),\nVelocidad_viento_ms = c(0, 50),\nRadiacion_global_Wm2 = c(0, 1500),\nPrecipitacion_mm = c(0, 100),\nHumedad_suelo_5cm_m3m3 = c(0, 0.6),\nHumedad_suelo_40cm_m3m3 = c(0, 0.6)\n)\n\n#Fuera de rango\n\nfuera_rango <- list()\nfor (var in names(limites)) {\nif (var %in% colnames(datos)) {\nidx <- which(datos[[var]] < limites[[var]][1] | datos[[var]] > limites[[var]][2])\nfuera_rango[[var]] <- list(\nn_fuera_rango = length(idx),\nporcentaje = round(length(idx) / nrow(datos) * 100, 2)\n)\n}\n}\nresultados_cc$fuera_rango <- fuera_rango\n\n#Atípicos por IQR\n\natipicos_iqr <- list()\nvariables_verificar <- c(\n\"Radiacion_global_Wm2\",\n\"Precipitacion_mm\",\n\"Rayos_conteo\",\n\"Velocidad_viento_ms\",\n\"Direccion_viento_grados\",\n\"Rachas_ms\",\n\"Temperatura_aire_C\",\n\"Presion_atmosferica_mbar\",\n\"Humedad_relativa_porc\",\n\"Radiacion_global_MJm2\",\n\"Temperatura_superficie_C\",\n\"Flujo_energia_suelo_Wm2\",\n\"Radiacion_neta_Wm2\",\n\"Temperatura_termocupla1_C\",\n\"Temperatura_termocupla2_C\",\n\"Humedad_suelo_5cm_m3m3\",\n\"Humedad_suelo_40cm_m3m3\"\n)\n\nfor (var in variables_verificar) {\nif (var %in% colnames(datos)) {\nQ1 <- quantile(datos[[var]], 0.25, na.rm = TRUE)\nQ3 <- quantile(datos[[var]], 0.75, na.rm = TRUE)\nIQR_val <- Q3 - Q1\nlower <- Q1 - 1.5 * IQR_val\nupper <- Q3 + 1.5 * IQR_val\nidx_atip <- which(datos[[var]] < lower | datos[[var]] > upper)\natipicos_iqr[[var]] <- list(\nn_atipicos = length(idx_atip),\nporcentaje = round(length(idx_atip) / nrow(datos) * 100, 2)\n)\n}\n}\nresultados_cc$atipicos_iqr <- atipicos_iqr\n\n#Completitud de variables esenciales\n\nvars_esenciales <- c(\n\"Radiacion_global_Wm2\",\n\"Precipitacion_mm\",\n\"Rayos_conteo\",\n\"Velocidad_viento_ms\",\n\"Direccion_viento_grados\",\n\"Rachas_ms\",\n\"Temperatura_aire_C\",\n\"Presion_atmosferica_mbar\",\n\"Humedad_relativa_porc\",\n\"Radiacion_global_MJm2\",\n\"Temperatura_superficie_C\",\n\"Flujo_energia_suelo_Wm2\",\n\"Radiacion_neta_Wm2\",\n\"Temperatura_termocupla1_C\",\n\"Temperatura_termocupla2_C\",\n\"Humedad_suelo_5cm_m3m3\",\n\"Humedad_suelo_40cm_m3m3\"\n)\n\ncompletitud <- sapply(vars_esenciales, function(x) {\nif (x %in% colnames(datos)) {\nround(sum(!is.na(datos[[x]])) / nrow(datos) * 100, 2)\n} else {\nNA\n}\n})\nresultados_cc$completitud <- completitud\n\n#Saltos temporales distintos a 1 hora\n\ndatos2 <- datos %>%\narrange(fecha_hora) %>%\nmutate(diff_tiempo_h = as.numeric(difftime(fecha_hora, lag(fecha_hora), units = \"hours\")))\n\nsaltos_tiempo <- which(datos2$diff_tiempo_h != 1 & !is.na(datos2$diff_tiempo_h))\nresultados_cc$saltos_temporales <- length(saltos_tiempo)\n\nreturn(resultados_cc)\n}\n\n#| label: crear-datos-qc\n#| echo: true\n\n#Rangos para flags (coherentes con la metodología)\n\nrango_temp <- c(-10, 45)\nrango_hr <- c(0, 100)\nrango_pp <- c(0, Inf)\nrango_viento <- c(0, Inf)\nrango_rn <- c(-200, 1000)\n\ndatos_qc <- datos_brutos %>%\nmutate(\nflag_temp_rango = case_when(\nis.na(Temperatura_aire_C) ~ \"na\",\nTemperatura_aire_C < rango_temp[1] | Temperatura_aire_C > rango_temp[2] ~ \"fuera_rango\",\nTRUE ~ \"ok\"\n),\nflag_hr_rango = case_when(\nis.na(Humedad_relativa_porc) ~ \"na\",\nHumedad_relativa_porc < rango_hr[1] | Humedad_relativa_porc > rango_hr[2] ~ \"fuera_rango\",\nTRUE ~ \"ok\"\n),\nflag_pp_rango = case_when(\nis.na(Precipitacion_mm) ~ \"na\",\nPrecipitacion_mm < rango_pp[1] ~ \"negativa\",\nTRUE ~ \"ok\"\n),\nflag_ws_rango = case_when(\nis.na(Velocidad_viento_ms) ~ \"na\",\nVelocidad_viento_ms < rango_viento[1] ~ \"negativa\",\nTRUE ~ \"ok\"\n),\nflag_rn_rango = case_when(\nis.na(Radiacion_neta_Wm2) ~ \"na\",\nRadiacion_neta_Wm2 < rango_rn[1] | Radiacion_neta_Wm2 > rango_rn[2] ~ \"fuera_rango\",\nTRUE ~ \"ok\"\n)\n)\n```\n:::\n\n\nResultados\n========================\n\n**Resultados del análisis exploratorio**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresultados_ae <- analisis_exploratorio(datos_brutos)\n\n#Info básica en tabla\n\ninfo_basica <- as.data.frame(resultados_ae$info_basica)\ninfo_basica\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  n_filas n_columnas fecha_inicio  fecha_fin duracion_dias\n1    2438         32   1753106400 1764342000      130.0417\n```\n\n\n:::\n\n```{.r .cell-code}\n#| label: estadisticas-principales\n#| echo: true\n\nestadisticas_df <- purrr::map_dfr(\nresultados_ae$estadisticas,\n~ as.data.frame(.x),\n.id = \"variable\"\n)\n\nestadisticas_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    variable         media   mediana   desviacion       min\n1       Radiacion_global_Wm2  1.891088e+02   10.8350 2.617007e+02     0.000\n2           Precipitacion_mm  2.940427e-02    0.0000 2.730409e-01     0.000\n3               Rayos_conteo  2.875924e-03    0.0000 8.354031e-02     0.000\n4        Velocidad_viento_ms  5.160140e-01    0.4580 3.449411e-01     0.048\n5    Direccion_viento_grados  1.761297e+02  163.9000 7.951649e+01     0.900\n6                  Rachas_ms  1.511889e+00    1.3470 1.043812e+00     0.123\n7         Temperatura_aire_C  1.559380e+01   14.2250 6.835956e+00     2.317\n8   Presion_atmosferica_mbar  1.016620e+03 1016.3310 3.036572e+00  1009.648\n9      Humedad_relativa_porc  6.761639e+01   70.6500 2.316700e+01    15.700\n10     Radiacion_global_MJm2  6.816402e-01    0.0366 9.424293e-01     0.000\n11  Temperatura_superficie_C  1.596208e+01   13.7500 8.175708e+00     1.126\n12   Flujo_energia_suelo_Wm2 -9.835949e-02   -1.0150 4.760450e+00   -10.820\n13        Radiacion_neta_Wm2  5.264392e+02  317.9000 7.687920e+02 -1642.000\n14 Temperatura_termocupla1_C  1.658387e+01   14.1500 8.853681e+00     0.719\n15 Temperatura_termocupla2_C  1.658374e+01   14.1500 8.853524e+00     0.721\n16    Humedad_suelo_5cm_m3m3  3.570538e-01    0.3650 3.624735e-02     0.214\n17   Humedad_suelo_40cm_m3m3  4.897650e-01    0.4910 5.753877e-03     0.476\n         max nas\n1   873.0000   0\n2     6.0350   4\n3     3.0000   4\n4     2.1030   4\n5   359.7000   4\n6     6.3280   4\n7    32.9200   4\n8  1027.0980   4\n9   100.0000   4\n10    3.1428   4\n11   36.3800   4\n12   12.4600   4\n13 3004.0000   4\n14   38.4300   4\n15   38.4300   4\n16    0.4500   4\n17    0.5010   4\n```\n\n\n:::\n\n```{.r .cell-code}\n#| label: valores-faltantes\n#| echo: true\n\nvalores_faltantes_df <- data.frame(\nvariable = names(resultados_ae$valores_faltantes),\nn_na = as.numeric(resultados_ae$valores_faltantes)\n)\n\nvalores_faltantes_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    variable n_na\n1                 fecha_hora  105\n2           Precipitacion_mm    4\n3               Rayos_conteo    4\n4                Dist_km_Avg    4\n5        Velocidad_viento_ms    4\n6    Direccion_viento_grados    4\n7                  Rachas_ms    4\n8         Temperatura_aire_C    4\n9                VP_mbar_Avg    4\n10  Presion_atmosferica_mbar    4\n11                      ETos    4\n12                       Rso    4\n13     Humedad_relativa_porc    4\n14                     RHT_C    4\n15            TiltNS_deg_Avg    4\n16            TiltWE_deg_Avg    4\n17     Radiacion_global_MJm2    4\n18                    CVMeta   14\n19              Invalid_Wind    4\n20                  TT_C_Avg    4\n21  Temperatura_superficie_C    4\n22   Flujo_energia_suelo_Wm2    4\n23        Radiacion_neta_Wm2    4\n24               CNR_Wm2_Avg    4\n25 Temperatura_termocupla1_C    4\n26 Temperatura_termocupla2_C    4\n27    Humedad_suelo_5cm_m3m3    4\n28   Humedad_suelo_40cm_m3m3    4\n```\n\n\n:::\n:::\n\n\n**Resumen de flags por variable**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: resumen-flags\n#| echo: true\n\nresumen_flags <- datos_qc %>%\nsummarise(\ntemp_ok = sum(flag_temp_rango == \"ok\", na.rm = TRUE),\ntemp_fuera = sum(flag_temp_rango == \"fuera_rango\", na.rm = TRUE),\ntemp_na = sum(flag_temp_rango == \"na\", na.rm = TRUE),\n\nhr_ok       = sum(flag_hr_rango == \"ok\",            na.rm = TRUE),\nhr_fuera    = sum(flag_hr_rango == \"fuera_rango\",   na.rm = TRUE),\nhr_na       = sum(flag_hr_rango == \"na\",            na.rm = TRUE),\n\npp_ok       = sum(flag_pp_rango == \"ok\",            na.rm = TRUE),\npp_negativa = sum(flag_pp_rango == \"negativa\",      na.rm = TRUE),\npp_na       = sum(flag_pp_rango == \"na\",            na.rm = TRUE),\n\nws_ok       = sum(flag_ws_rango == \"ok\",            na.rm = TRUE),\nws_negativa = sum(flag_ws_rango == \"negativa\",      na.rm = TRUE),\nws_na       = sum(flag_ws_rango == \"na\",            na.rm = TRUE),\n\nrn_ok       = sum(flag_rn_rango == \"ok\",            na.rm = TRUE),\nrn_fuera    = sum(flag_rn_rango == \"fuera_rango\",   na.rm = TRUE),\nrn_na       = sum(flag_rn_rango == \"na\",            na.rm = TRUE)\n\n)\n\nresumen_flags\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 15\n  temp_ok temp_fuera temp_na hr_ok hr_fuera hr_na pp_ok pp_negativa pp_na ws_ok\n    <int>      <int>   <int> <int>    <int> <int> <int>       <int> <int> <int>\n1    2434          0       4  2434        0     4  2434           0     4  2434\n# i 5 more variables: ws_negativa <int>, ws_na <int>, rn_ok <int>,\n#   rn_fuera <int>, rn_na <int>\n```\n\n\n:::\n\n```{.r .cell-code}\n#| label: resumen-flags-porcentaje\n#| echo: true\n\nn_total <- nrow(datos_qc)\n\nresumen_flags_porcentaje <- resumen_flags %>%\nmutate(across(everything(), ~ .x / n_total * 100))\n\nresumen_flags_porcentaje\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 15\n  temp_ok temp_fuera temp_na hr_ok hr_fuera hr_na pp_ok pp_negativa pp_na ws_ok\n    <dbl>      <dbl>   <dbl> <dbl>    <dbl> <dbl> <dbl>       <dbl> <dbl> <dbl>\n1    99.8          0   0.164  99.8        0 0.164  99.8           0 0.164  99.8\n# i 5 more variables: ws_negativa <dbl>, ws_na <dbl>, rn_ok <dbl>,\n#   rn_fuera <dbl>, rn_na <dbl>\n```\n\n\n:::\n\n```{.r .cell-code}\n#| label: resumen-flags-porcentaje\n#| echo: true\n\nn_total <- nrow(datos_qc)\n\nresumen_flags_porcentaje <- resumen_flags %>%\nmutate(across(everything(), ~ .x / n_total * 100))\n\n#resumen_flags_porcentaje\n```\n:::\n\n\n**Resultados del control de calidad**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresultados_cc <- control_calidad(datos_brutos)\n\nfuera_rango_df <- purrr::map_dfr(\nresultados_cc$fuera_rango,\n~ as.data.frame(.x),\n.id = \"variable\"\n)\n\natipicos_iqr_df <- purrr::map_dfr(\nresultados_cc$atipicos_iqr,\n~ as.data.frame(.x),\n.id = \"variable\"\n)\n\ncompletitud_df <- data.frame(\nvariable = names(resultados_cc$completitud),\ncompletitud = as.numeric(resultados_cc$completitud)\n)\n\nlist(\nfuera_rango = fuera_rango_df,\natipicos_iqr = atipicos_iqr_df,\ncompletitud = completitud_df,\nsaltos_tiempo = resultados_cc$saltos_temporales\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$fuera_rango\n                 variable n_fuera_rango porcentaje\n1      Temperatura_aire_C             0          0\n2   Humedad_relativa_porc             0          0\n3     Velocidad_viento_ms             0          0\n4    Radiacion_global_Wm2             0          0\n5        Precipitacion_mm             0          0\n6  Humedad_suelo_5cm_m3m3             0          0\n7 Humedad_suelo_40cm_m3m3             0          0\n\n$atipicos_iqr\n                    variable n_atipicos porcentaje\n1       Radiacion_global_Wm2          0       0.00\n2           Precipitacion_mm        179       7.34\n3               Rayos_conteo          3       0.12\n4        Velocidad_viento_ms         10       0.41\n5    Direccion_viento_grados          0       0.00\n6                  Rachas_ms          4       0.16\n7         Temperatura_aire_C          0       0.00\n8   Presion_atmosferica_mbar         28       1.15\n9      Humedad_relativa_porc          0       0.00\n10     Radiacion_global_MJm2          0       0.00\n11  Temperatura_superficie_C          0       0.00\n12   Flujo_energia_suelo_Wm2          0       0.00\n13        Radiacion_neta_Wm2         66       2.71\n14 Temperatura_termocupla1_C          0       0.00\n15 Temperatura_termocupla2_C          0       0.00\n16    Humedad_suelo_5cm_m3m3        190       7.79\n17   Humedad_suelo_40cm_m3m3          0       0.00\n\n$completitud\n                    variable completitud\n1       Radiacion_global_Wm2      100.00\n2           Precipitacion_mm       99.84\n3               Rayos_conteo       99.84\n4        Velocidad_viento_ms       99.84\n5    Direccion_viento_grados       99.84\n6                  Rachas_ms       99.84\n7         Temperatura_aire_C       99.84\n8   Presion_atmosferica_mbar       99.84\n9      Humedad_relativa_porc       99.84\n10     Radiacion_global_MJm2       99.84\n11  Temperatura_superficie_C       99.84\n12   Flujo_energia_suelo_Wm2       99.84\n13        Radiacion_neta_Wm2       99.84\n14 Temperatura_termocupla1_C       99.84\n15 Temperatura_termocupla2_C       99.84\n16    Humedad_suelo_5cm_m3m3       99.84\n17   Humedad_suelo_40cm_m3m3       99.84\n\n$saltos_tiempo\n[1] 103\n```\n\n\n:::\n:::\n\n\nVisualización gráfica de las variables\n======================================\n\n**Series temporales facetadas de variables principales**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: graf-series-temporales-facetas\n#| fig-cap: \"Series temporales de variables meteorológicas (facetadas por variable).\"\n#| echo: false\n\ndatos_largo <- datos_brutos %>%\ndplyr::select(\nfecha_hora,\nRadiacion_global_Wm2,\nTemperatura_aire_C,\nHumedad_relativa_porc,\nPrecipitacion_mm,\nVelocidad_viento_ms,\nPresion_atmosferica_mbar\n) %>%\ntidyr::pivot_longer(\ncols = -fecha_hora,\nnames_to = \"Variable\",\nvalues_to = \"Valor\"\n)\n\nseries_temporales <- ggplot(datos_largo, aes(x = fecha_hora, y = Valor, color = Variable)) +\ngeom_line(linewidth = 0.3, alpha = 0.8) +\nfacet_wrap(~ Variable, scales = \"free_y\", ncol = 2) +\nscale_color_manual(values = c(\n\"Humedad_relativa_porc\" = \"blue\",\n\"Presion_atmosferica_mbar\" = \"darkgreen\",\n\"Temperatura_aire_C\" = \"red\",\n\"Precipitacion_mm\" = \"cyan\",\n\"Radiacion_global_Wm2\" = \"orange\",\n\"Velocidad_viento_ms\" = \"purple\"\n)) +\nlabs(\ntitle = \"Series temporales de variables meteorológicas - Parcela 3\",\nx = \"Fecha y hora\",\ny = \"\"\n) +\ntheme_bw() +\ntheme(\naxis.text.x = element_text(angle = 45, hjust = 1),\nlegend.position = \"none\"\n)\n\nseries_temporales\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 630 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Calidad_datos_files/figure-pdf/unnamed-chunk-3-1.pdf){fig-pos='H'}\n:::\n:::\n\n**Humedad del suelo en el tiempo (2 profundidades)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: graf-humedad-suelo-tiempo\n#| fig-cap: \"Humedad del suelo a 5 y 40 cm en el tiempo.\"\n#| echo: false\n\ndatos_suelo <- datos_brutos %>%\ndplyr::select(\nfecha_hora,\nHumedad_suelo_5cm_m3m3,\nHumedad_suelo_40cm_m3m3\n) %>%\ntidyr::pivot_longer(\ncols = -fecha_hora,\nnames_to = \"Profundidad\",\nvalues_to = \"Humedad\"\n)\n\nHumedad_Suelo <- ggplot(datos_suelo, aes(x = fecha_hora, y = Humedad, color = Profundidad)) +\ngeom_line(linewidth = 0.5) +\nlabs(\ntitle = \"Humedad del suelo a diferentes profundidades\",\nx = \"Fecha y hora\",\ny = \"Humedad (m³/m³)\",\ncolor = \"Profundidad\"\n) +\ntheme_bw() +\ntheme(legend.position = \"top\")\n\nHumedad_Suelo\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 210 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Calidad_datos_files/figure-pdf/unnamed-chunk-4-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n**Precipitación diaria acumulada**\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_col()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Precipitación diaria acumulada.](Calidad_datos_files/figure-pdf/graf-precipitacion-diaria-1.pdf)\n:::\n:::\n\n\n**Rosa de vientos**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Rosa de vientos (dirección y velocidad del viento).](Calidad_datos_files/figure-pdf/graf-rosa-vientos-1.pdf)\n:::\n:::\n\n\n**Distribución de temperaturas**\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 16 rows containing non-finite outside the scale range\n(`stat_boxplot()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 16 rows containing non-finite outside the scale range\n(`stat_summary()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Distribución de temperaturas del aire, superficie y termocuplas.](Calidad_datos_files/figure-pdf/graf-distribucion-temperaturas-1.pdf)\n:::\n:::\n\n\n**Generación de base de datos validada**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos_validados <- datos_qc %>%\nmutate(\nTemperatura_aire_C = if_else(flag_temp_rango == \"ok\", Temperatura_aire_C, NA_real_),\nHumedad_relativa_porc = if_else(flag_hr_rango == \"ok\", Humedad_relativa_porc, NA_real_),\nPrecipitacion_mm = if_else(flag_pp_rango == \"ok\", Precipitacion_mm, NA_real_),\nVelocidad_viento_ms = if_else(flag_ws_rango == \"ok\", Velocidad_viento_ms, NA_real_),\nRadiacion_neta_Wm2 = if_else(flag_rn_rango == \"ok\", Radiacion_neta_Wm2, NA_real_)\n)\n\nreadr::write_csv(datos_validados, \"Datos_Parcela_3_validado.csv\")\n\ndatos_validados %>%\nsummarise(\nn_temp_validas = sum(!is.na(Temperatura_aire_C)),\nn_hr_validas = sum(!is.na(Humedad_relativa_porc)),\nn_pp_validas = sum(!is.na(Precipitacion_mm)),\nn_ws_validas = sum(!is.na(Velocidad_viento_ms)),\nn_rn_validas = sum(!is.na(Radiacion_neta_Wm2))\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 x 5\n  n_temp_validas n_hr_validas n_pp_validas n_ws_validas n_rn_validas\n           <int>        <int>        <int>        <int>        <int>\n1           2434         2434         2434         2434         1821\n```\n\n\n:::\n:::\n\n---\n\n```{#}\n```\n",
    "supporting": [
      "Calidad_datos_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}